<!doctype html>
<html lang="sk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jedálny lístok | Energo</title>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='12' fill='black'/%3E%3Cpath d='M12 40h12l4-16 8 24 6-16h10' stroke='white' stroke-width='4' fill='none'/%3E%3Cpath d='M8 20h16' stroke='%23ff1a1a' stroke-width='4'/%3E%3C/svg%3E" />

  <style>
    :root{
      --bg:#0c0c0d; --surface:#111113; --text:#e6e6e8; --muted:#b6b6bb;
      --accent:#e11d2e; --accent-700:#960b17; --border:#1e1f22; --radius:16px;
      --shadow:0 12px 34px rgba(0,0,0,.35);
      --font:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,Cantarell,"Noto Sans","Helvetica Neue",Arial;
    }
    @media (prefers-color-scheme:light){
      :root{ --bg:#f6f7f9; --surface:#ffffff; --text:#0c0c0d; --muted:#5b606a; --border:#e8e9ed; }
    }

    html,body{height:100%}
    body{
      margin:0; font-family:var(--font); color:var(--text);
      background:linear-gradient(180deg,#0a0a0a 0%,#0f0f11 100%);
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    }

    .wrap{max-width:1100px;margin:0 auto;padding:24px 16px}

    /* === Card (jednotný štýl) === */
    .card{
      width:min(1000px,94vw); margin:clamp(16px,4vw,40px) auto; padding:18px 18px 22px;
      background:linear-gradient(180deg,rgba(255,255,255,.02),transparent 120%),var(--surface);
      border:1px solid var(--border); border-radius:var(--radius);
      backdrop-filter:saturate(120%) blur(6px); box-shadow:var(--shadow);
      position:relative; will-change:transform;
      transform:perspective(900px) rotateX(0deg) rotateY(0deg) translateZ(0);
      transition:transform .25s cubic-bezier(.2,.6,.2,1), box-shadow .25s;
    }
    .card::before{
      content:""; position:absolute; left:-1px; right:-1px; top:-1px; height:3px; opacity:.95;
      border-top-left-radius:calc(var(--radius)+2px); border-top-right-radius:calc(var(--radius)+2px);
      background:linear-gradient(90deg,transparent,var(--accent) 22%,var(--accent) 78%,transparent);
      pointer-events:none;
    }
    .head{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
    .title{display:flex;align-items:center;gap:10px}
    .title h1{font-size:clamp(20px,3.2vw,26px);margin:0}
    .updated{color:var(--muted);font-weight:600}

    /* image + shimmer */
    .figure{position:relative;overflow:hidden;border-radius:calc(var(--radius) - 8px);background:#0f0f11}
    .img{width:100%;height:auto;display:block;cursor:zoom-in;image-rendering:auto}
    .figure::after{
      content:"";position:absolute;inset:0;background:
        linear-gradient(90deg,rgba(255,255,255,0),rgba(255,255,255,.08),rgba(255,255,255,0));
      transform:translateX(-100%);animation:shimmer 1.1s infinite;pointer-events:none
    }
    .figure.loaded::after{display:none}
    @keyframes shimmer{to{transform:translateX(100%)}}

    .actions{display:flex;justify-content:flex-end;gap:10px;margin-top:12px;flex-wrap:wrap}
    .btn{padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:transparent;color:inherit;text-decoration:none;font-weight:800}
    .btn:hover{border-color:var(--accent)}
    .btn-accent{border-color:color-mix(in oklab, var(--accent) 60%, transparent);color:var(--accent)}

    /* jemný sheen/tilt */
    .card::after{
      content:""; position:absolute; inset:-1px; border-radius:var(--radius); pointer-events:none;
      background:radial-gradient(320px 200px at calc(50% + var(--sheen-x,0px)) calc(50% + var(--sheen-y,0px)),
        rgba(255,255,255,.10), rgba(255,255,255,0) 60%);
      opacity: var(--sheen-opacity,0); mix-blend-mode:screen; transition:opacity .25s;
    }

    /* === Lightbox (bez „black barov“) === */
    .lightbox{position:fixed;inset:0;display:none;place-items:center;z-index:50;background:rgba(0,0,0,.76);backdrop-filter:blur(2px)}
    .lightbox.open{display:grid}
    .lb-inner{
      position:relative;
      width:min(95vw,1200px);
      max-height:92vh;
      overflow:hidden;         /* skry panovanie mimo rám */
      display:grid;place-items:center;
    }
    .lb-img{
      display:block;
      max-width:none; max-height:none; /* vlastné fitovanie robíme sami */
      border-radius:16px; box-shadow:0 20px 60px rgba(0,0,0,.55);
      will-change:transform;
      transform-origin:0 0;             /* pre zoom okolo kurzora */
      cursor:grab;
      image-rendering:auto;
      animation:lbIn .16s ease-out;
    }
    .lb-img.grabbing{ cursor:grabbing; }
    @keyframes lbIn{from{transform:scale(.96);opacity:.6}to{transform:scale(1);opacity:1}}
    .lb-close{position:absolute;top:8px;right:8px;border:none;cursor:pointer;border-radius:10px;padding:6px 10px;background:rgba(0,0,0,.45);color:#fff;font-weight:800}
    .lb-close:focus-visible{outline:2px solid var(--accent);outline-offset:2px}

    .lb-hint{
      position:absolute;left:50%;bottom:8px;transform:translateX(-50%);
      font-size:12px;color:#e2e2e6; opacity:.8; background:rgba(0,0,0,.35);
      padding:6px 10px;border-radius:999px; pointer-events:none; user-select:none;
    }

    /* Mobile */
    @media (max-width:640px){
      .card{padding:14px}
      .title h1{font-size:1.06rem}
      .updated{font-size:.9rem}
      .actions{justify-content:center}
      .lb-hint{font-size:11px}
    }
    @media (prefers-reduced-motion:reduce){
      .card{transition:none}
      .card::after{display:none}
    }
  </style>
</head>
<body>
  <main class="wrap">
    <section class="card" id="menuCard" aria-labelledby="menuTitle">
      <div class="head">
        <div class="title"><h1 id="menuTitle">Jedálny lístok</h1></div>
        <time class="updated" id="menuUpdated" datetime="">Aktualizované — …</time>
      </div>

      <figure class="figure" id="menuFigure">
        <img id="menuImg" class="img" alt="Jedálny lístok" loading="lazy" decoding="async">
      </figure>

      <div class="actions">
        <a class="btn" id="openFull" href="/assets/menu.jpg" target="_blank" rel="noopener">Otvoriť originál</a>
      </div>
    </section>
  </main>

  <!-- Lightbox -->
  <div class="lightbox" id="lb" role="dialog" aria-modal="true" aria-label="Zväčšený jedálny lístok">
    <div class="lb-inner" id="lbViewport">
      <button class="lb-close" id="lbClose" type="button">✕</button>
      <img class="lb-img" id="lbImg" alt="">
      <div class="lb-hint">Kolieskom priblíženie • Ťahaním posun</div>
    </div>
  </div>

  <script>
    (function(){
      const today = new Date().toISOString().slice(0,10);
      const base  = '/assets/menu.jpg';

      // DOM
      const img = document.getElementById('menuImg');
      const fig = document.getElementById('menuFigure');
      const updatedEl = document.getElementById('menuUpdated');
      const openFull = document.getElementById('openFull');

      // načítanie
      img.src = base + '?v=' + today;
      function markLoaded(){ fig.classList.add('loaded'); }
      if (img.complete) markLoaded(); else img.addEventListener('load', markLoaded);
      img.addEventListener('error', ()=>{ markLoaded(); img.alt='Nepodarilo sa načítať jedálny lístok.'; });

      fetch(base + '.json', { cache:'no-store' })
        .then(r => r.ok ? r.json() : null)
        .then(d=>{
          const full = (d && d.img) || base;
          const dt   = new Date((d && d.fetchedAt) || Date.now());
          updatedEl.dateTime = dt.toISOString();
          updatedEl.textContent = 'Aktualizované — ' + dt.toLocaleString('sk-SK', { dateStyle:'medium', timeStyle:'short' });
          openFull.href = full + '?v=' + today;
          img.dataset.full = full + '?v=' + today;
        })
        .catch(()=>{ img.dataset.full = base + '?v=' + today; });

      // Lightbox + zoom & drag
      const lb       = document.getElementById('lb');
      const lbImg    = document.getElementById('lbImg');
      const lbClose  = document.getElementById('lbClose');
      const viewport = document.getElementById('lbViewport');

      const S = { scale:1, min:1, max:8, tx:0, ty:0, vw:0, vh:0, iw:0, ih:0 };
      let dragging = false, sx=0, sy=0, ox=0, oy=0;

      function fitToViewport(){
        S.vw = viewport.clientWidth;
        S.vh = viewport.clientHeight;
        S.iw = lbImg.naturalWidth  || lbImg.width;
        S.ih = lbImg.naturalHeight || lbImg.height;

        // „contain“ fit (bez barov vnútri kontajnera)
        const sx = S.vw / S.iw, sy = S.vh / S.ih;
        S.min   = Math.min(sx, sy);
        S.scale = S.min;

        // centrovanie
        S.tx = (S.vw - S.iw * S.scale) * 0.5;
        S.ty = (S.vh - S.ih * S.scale) * 0.5;
        apply();
      }
      function apply(){
        lbImg.style.transform = `translate(${S.tx}px, ${S.ty}px) scale(${S.scale})`;
      }
      function openLB(){
        lbImg.src = img.dataset.full || img.src;
        lb.classList.add('open');
        lbClose.focus();
        if (lbImg.complete) fitToViewport();
        else lbImg.onload = fitToViewport;
      }
      function closeLB(){
        lb.classList.remove('open');
        lbImg.src = '';
      }

      // wheel zoom (okolo kurzora)
      const STEP = 1.15;
      function zoomAt(x, y, factor){
        const ns = Math.min(S.max, Math.max(S.min, S.scale * factor));
        if (ns === S.scale) return;

        // bod v obrázku pod kurzorom (pred zmenou scale)
        const imgX = (x - S.tx) / S.scale;
        const imgY = (y - S.ty) / S.scale;

        // nový posun tak, aby NEMENIL bod pod kurzorom
        S.tx = x - imgX * ns;
        S.ty = y - imgY * ns;

        // ak ideš naspäť na fit, znova presne na stred a žiadne posúvanie
        if (ns <= S.min){
          fitToViewport();
          return;
        }
        S.scale = ns;
        clampTranslate();
        apply();
      }

      function clampTranslate(){
        // nech obrázok neodíde úplne mimo viewport
        const w = S.iw * S.scale, h = S.ih * S.scale;
        const minX = Math.min(0, S.vw - w), maxX = Math.max(0, S.vw - w);
        const minY = Math.min(0, S.vh - h), maxY = Math.max(0, S.vh - h);
        S.tx = Math.min(maxX, Math.max(minX, S.tx));
        S.ty = Math.min(maxY, Math.max(minY, S.ty));
      }

      // drag
      function onDown(e){
        if (S.scale <= S.min) return; // pri fit nepohybujeme
        dragging = true; lbImg.classList.add('grabbing');
        sx = e.clientX; sy = e.clientY; ox = S.tx; oy = S.ty;
        window.addEventListener('pointermove', onMove);
        window.addEventListener('pointerup', onUp, { once:true });
      }
      function onMove(e){
        if (!dragging) return;
        S.tx = ox + (e.clientX - sx);
        S.ty = oy + (e.clientY - sy);
        clampTranslate();
        apply();
      }
      function onUp(){
        dragging = false; lbImg.classList.remove('grabbing');
        window.removeEventListener('pointermove', onMove);
      }

      // events
      img.addEventListener('click', openLB);
      lb.addEventListener('click', e => { if (e.target === lb) closeLB(); });
      lbClose.addEventListener('click', closeLB);
      document.addEventListener('keydown', e => { if (e.key === 'Escape' && lb.classList.contains('open')) closeLB(); });

      viewport.addEventListener('wheel', e=>{
        e.preventDefault();
        const r = viewport.getBoundingClientRect();
        const x = e.clientX - r.left, y = e.clientY - r.top;
        zoomAt(x, y, e.deltaY > 0 ? 1/STEP : STEP);
      }, { passive:false });

      lbImg.addEventListener('pointerdown', onDown);

      window.addEventListener('resize', ()=>{ if(lb.classList.contains('open')) fitToViewport(); });

      // jemný tilt na karte (zjemnené)
      const card = document.getElementById('menuCard');
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const isCoarse = window.matchMedia('(pointer: coarse)').matches;
      if (card && !prefersReduced && !isCoarse){
        const MAX = 1.1, SHEEN = 6; let rafId = 0;
        function applyTilt(rx, ry, sx, sy, sheen){
          cancelAnimationFrame(rafId);
          rafId = requestAnimationFrame(()=>{
            card.style.transform = `perspective(900px) rotateX(${ry.toFixed(2)}deg) rotateY(${rx.toFixed(2)}deg) translateZ(0)`;
            card.style.setProperty('--sheen-x', `${sx.toFixed(1)}px`);
            card.style.setProperty('--sheen-y', `${sy.toFixed(1)}px`);
            card.style.setProperty('--sheen-opacity', sheen ? '1' : '0');
          });
        }
        function onMove(e){
          const r = card.getBoundingClientRect();
          const px = (e.clientX - r.left) / r.width;
          const py = (e.clientY - r.top)  / r.height;
          applyTilt((px - .5)*(MAX*2), (0.5 - py)*(MAX*2), (px-.5)*SHEEN, (py-.5)*SHEEN, 1);
        }
        function reset(){ applyTilt(0,0,0,0,0); }
        card.addEventListener('pointermove', onMove);
        card.addEventListener('pointerleave', reset);
      }
    })();
  </script>
</body>
</html>
